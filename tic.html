<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polished Tic-Tac-Toe</title>
    <!-- Tailwind CSS for utility-first styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js for web audio -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            background: linear-gradient(135deg, #f0f9ff 0%, #dbeafe 100%);
            transition: background-color 0.5s ease;
        }
        .container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 0.75rem;
            background-color: #e2e8f0;
            border-radius: 1.5rem;
            padding: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        .cell {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            font-weight: bold;
            color: #4a5568;
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border-radius: 1rem;
            cursor: pointer;
            box-shadow: 5px 5px 10px #d1d9e6, -5px -5px 10px #ffffff;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .cell:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.1), -5px -5px 15px #ffffff;
        }
        .cell:active {
            transform: scale(0.95);
            box-shadow: inset 3px 3px 7px #d1d9e6, inset -3px -3px 7px #ffffff;
        }
        .cell.x {
            color: #ef4444;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .cell.o {
            color: #3b82f6;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .cell.x::after {
            content: "X";
        }
        .cell.o::after {
            content: "O";
        }
        .cell.win {
            background: #10b981;
            color: #ffffff;
            animation: winFlash 1s infinite alternate;
        }
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes winFlash {
            from { background-color: #10b981; box-shadow: 0 0 15px #10b981; }
            to { background-color: #047857; box-shadow: 0 0 25px #047857; }
        }
        .message-box {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 400px;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            padding: 24px;
            text-align: center;
            color: #1a202c;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 10;
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -40%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }
        .button {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }
        .button:active {
            transform: translateY(0);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <!-- Main Game Container -->
    <div class="container bg-white rounded-3xl shadow-2xl w-full max-w-lg p-6 sm:p-8">

        <!-- Main Menu Screen -->
        <div id="menu" class="flex flex-col items-center justify-center w-full text-center p-4">
            <h1 class="text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-indigo-600 mb-12 tracking-tighter">Tic Tac Toe</h1>
            <div class="flex flex-col sm:flex-row space-y-6 sm:space-y-0 sm:space-x-6 w-full justify-center">
                <!-- Single Player Card -->
                <div id="singlePlayerCard" class="bg-white rounded-2xl shadow-xl p-8 cursor-pointer transform transition-all hover:scale-105 active:scale-95 duration-300 w-full sm:w-1/2">
                    <div class="text-6xl mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-blue-500 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-blue-800">Single Player</h2>
                    <p class="text-sm text-gray-500 mt-2">Challenge the AI</p>
                </div>
                <!-- Two Player Card -->
                <div id="twoPlayerCard" class="bg-white rounded-2xl shadow-xl p-8 cursor-pointer transform transition-all hover:scale-105 active:scale-95 duration-300 w-full sm:w-1/2">
                    <div class="text-6xl mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-green-500 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H2v-2a4 4 0 014-4h2.5M10 12a4 4 0 11-8 0 4 4 0 018 0zm0 0v1m-2.5 2.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zm-3 8a3 3 0 11-6 0 3 3 0 016 0zm0 0v1m-3 8a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                    </div>
                    <h2 class="text-2xl font-bold text-green-800">2 Player</h2>
                    <p class="text-sm text-gray-500 mt-2">Play with a friend</p>
                </div>
            </div>
            <div class="mt-10">
                <a href="index.html" class="text-sm text-gray-400 hover:text-gray-600 transition-colors">
                    Back to Homepage
                </a>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game" class="hidden flex-col items-center w-full text-center p-4">
            <button id="backBtn" class="self-start text-gray-500 hover:text-gray-700 transition-all transform hover:scale-105 mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12" />
                </svg>
                <span class="ml-2 text-lg font-semibold">Back</span>
            </button>
            <h1 id="gameTitle" class="text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-indigo-600 mb-6 tracking-tight"></h1>
            <div id="board" class="board w-full max-w-md aspect-square"></div>
            <div id="status" class="mt-8 text-2xl font-bold text-gray-800"></div>
            <button id="resetBtn" class="button mt-8 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all">
                Reset
            </button>
        </div>

        <!-- Message Box -->
        <div id="messageBox" class="message-box">
            <h2 id="messageTitle" class="text-3xl font-bold mb-2"></h2>
            <p id="messageText" class="text-xl text-gray-600 mb-6"></p>
            <button id="closeMessageBtn" class="button px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-full shadow-lg transition-all">
                Close
            </button>
        </div>

    </div>

    <script>
        // Tone.js requires user interaction to start the audio context
        document.body.addEventListener('click', () => {
            if (Tone.context.state !== 'running') {
                Tone.start();
            }
        });

        // Sound Effects
        const synth = new Tone.PolySynth(Tone.Synth).toDestination();
        const winSynth = new Tone.MonoSynth({
            oscillator: { type: 'sine' },
            envelope: {
                attack: 0.1,
                decay: 0.2,
                sustain: 0,
                release: 0.5
            }
        }).toDestination();
        const drawSynth = new Tone.MonoSynth({
            oscillator: { type: 'sawtooth' },
            envelope: {
                attack: 0.05,
                decay: 0.2,
                sustain: 0,
                release: 0.1
            }
        }).toDestination();

        function playMarkSound() {
            synth.triggerAttackRelease(['C4', 'E4'], '8n');
        }

        function playWinSound() {
            winSynth.triggerAttackRelease('C5', '4n');
            winSynth.triggerAttackRelease('E5', '4n', '+0.1');
            winSynth.triggerAttackRelease('G5', '4n', '+0.2');
        }

        function playDrawSound() {
            drawSynth.triggerAttackRelease('A3', '4n');
            drawSynth.triggerAttackRelease('A2', '4n', '+0.1');
        }

        // UI Elements
        const menuScreen = document.getElementById('menu');
        const gameScreen = document.getElementById('game');
        const singlePlayerCard = document.getElementById('singlePlayerCard');
        const twoPlayerCard = document.getElementById('twoPlayerCard');
        const backBtn = document.getElementById('backBtn');
        const resetBtn = document.getElementById('resetBtn');
        const boardElement = document.getElementById('board');
        const statusElement = document.getElementById('status');
        const gameTitleElement = document.getElementById('gameTitle');
        const messageBox = document.getElementById('messageBox');
        const messageTitle = document.getElementById('messageTitle');
        const messageText = document.getElementById('messageText');
        const closeMessageBtn = document.getElementById('closeMessageBtn');

        // Game State
        let gameBoard = ['', '', '', '', '', '', '', '', ''];
        let gameActive = false;
        let currentPlayer = 'X';
        let mode = ''; // 'single' or 'two'

        const winningCombinations = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8],
            [0, 3, 6], [1, 4, 7], [2, 5, 8],
            [0, 4, 8], [2, 4, 6]
        ];

        function showMenu() {
            gameScreen.classList.add('hidden');
            menuScreen.classList.remove('hidden');
            resetGame();
        }

        function showGame() {
            menuScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            resetGame();
            if (mode === 'single') {
                gameTitleElement.textContent = "Single Player";
                statusElement.textContent = "Your turn (X)";
            } else {
                gameTitleElement.textContent = "2 Player";
                statusElement.textContent = "X's turn";
            }
        }

        function resetGame() {
            gameBoard = ['', '', '', '', '', '', '', '', ''];
            gameActive = true;
            currentPlayer = 'X';
            renderBoard();
            statusElement.textContent = `${currentPlayer}'s turn`;
        }

        function renderBoard() {
            boardElement.innerHTML = '';
            gameBoard.forEach((cell, index) => {
                const cellElement = document.createElement('div');
                cellElement.classList.add('cell', 'aspect-square');
                cellElement.dataset.index = index;
                if (cell !== '') {
                    cellElement.classList.add(cell.toLowerCase());
                }
                cellElement.addEventListener('click', handleCellClick);
                boardElement.appendChild(cellElement);
            });
        }

        function handleCellClick(event) {
            const index = event.target.dataset.index;
            if (gameBoard[index] === '' && gameActive) {
                handlePlayerMove(index);
                if (mode === 'single' && gameActive) {
                    setTimeout(handleAIMove, 500);
                }
            }
        }

        function handlePlayerMove(index) {
            gameBoard[index] = currentPlayer;
            playMarkSound();
            renderBoard();
            checkWinOrDraw();
            if (gameActive) {
                switchPlayer();
            }
        }
        
        function switchPlayer() {
            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            if (mode === 'two') {
                statusElement.textContent = `${currentPlayer}'s turn`;
            } else {
                 statusElement.textContent = `Your turn (${currentPlayer})`;
            }
        }

        function checkWinOrDraw() {
            let roundWon = false;
            for (let i = 0; i < winningCombinations.length; i++) {
                const combo = winningCombinations[i];
                if (gameBoard[combo[0]] === gameBoard[combo[1]] && gameBoard[combo[1]] === gameBoard[combo[2]] && gameBoard[combo[0]] !== '') {
                    roundWon = true;
                    combo.forEach(index => {
                        boardElement.children[index].classList.add('win');
                    });
                    break;
                }
            }

            if (roundWon) {
                endGame(`${currentPlayer} wins!`);
                playWinSound();
            } else if (!gameBoard.includes('')) {
                endGame('Draw!');
                playDrawSound();
            }
        }
        
        function handleAIMove() {
            // Check for a winning move
            for (let i = 0; i < winningCombinations.length; i++) {
                const combo = winningCombinations[i];
                const [a, b, c] = combo;
                if (gameBoard[a] === 'O' && gameBoard[b] === 'O' && gameBoard[c] === '') { handlePlayerMove(c); return; }
                if (gameBoard[a] === 'O' && gameBoard[c] === 'O' && gameBoard[b] === '') { handlePlayerMove(b); return; }
                if (gameBoard[b] === 'O' && gameBoard[c] === 'O' && gameBoard[a] === '') { handlePlayerMove(a); return; }
            }
            // Block opponent's winning move
            for (let i = 0; i < winningCombinations.length; i++) {
                const combo = winningCombinations[i];
                const [a, b, c] = combo;
                if (gameBoard[a] === 'X' && gameBoard[b] === 'X' && gameBoard[c] === '') { handlePlayerMove(c); return; }
                if (gameBoard[a] === 'X' && gameBoard[c] === 'X' && gameBoard[b] === '') { handlePlayerMove(b); return; }
                if (gameBoard[b] === 'X' && gameBoard[c] === 'X' && gameBoard[a] === '') { handlePlayerMove(a); return; }
            }
            // Take the center if available
            if (gameBoard[4] === '') { handlePlayerMove(4); return; }
            // Take a corner if available
            const corners = [0, 2, 6, 8];
            for (let corner of corners) {
                if (gameBoard[corner] === '') { handlePlayerMove(corner); return; }
            }
            // Take any empty cell
            const emptyCells = gameBoard.reduce((acc, cell, index) => {
                if (cell === '') acc.push(index);
                return acc;
            }, []);
            if (emptyCells.length > 0) {
                const randomIndex = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                handlePlayerMove(randomIndex);
            }
        }
        
        function showMessage(title, text) {
            messageTitle.textContent = title;
            messageText.textContent = text;
            messageBox.style.display = 'flex';
        }

        function endGame(message) {
            gameActive = false;
            statusElement.textContent = message;
            showMessage('Game Over', message);
        }

        // Event Listeners
        singlePlayerCard.addEventListener('click', () => {
            mode = 'single';
            showGame();
        });

        twoPlayerCard.addEventListener('click', () => {
            mode = 'two';
            showGame();
        });

        backBtn.addEventListener('click', showMenu);
        resetBtn.addEventListener('click', resetGame);
        closeMessageBtn.addEventListener('click', () => {
            messageBox.style.display = 'none';
        });

        // Initialize game on page load
        window.onload = showMenu;
    </script>
</body>
</html>

